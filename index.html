<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yönetim Paneli</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&family=Metamorphous&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script> 
    <style>
        :root {
            --md-sys-color-primary: #bdb3ff;
            --md-sys-color-on-primary: #2d235c;
            --md-sys-color-primary-container: #443a74;
            --md-sys-color-on-primary-container: #e6deff;
            --md-sys-color-background: #131318;
            --md-sys-color-on-background: #e5e1e6;
            --md-sys-color-surface-container: #201f25;
            --md-sys-color-surface-container-high: #2a2830;
            --md-sys-color-on-surface: #e5e1e6;
            --md-sys-color-on-surface-variant: #c8c4d0;
            --md-sys-color-outline-variant: #48454e;
        }
        body {
            font-family: 'Manrope', sans-serif;
            background-color: var(--md-sys-color-background);
            color: var(--md-sys-color-on-background);
        }
        .form-input {
            background-color: var(--md-sys-color-surface-container-high);
            border: 1px solid var(--md-sys-color-outline-variant);
            color: var(--md-sys-color-on-surface);
            border-radius: 8px;
            padding: 10px;
            width: 100%;
            transition: border-color 0.2s ease;
        }
        .form-input:focus {
            border-color: var(--md-sys-color-primary);
            outline: none;
        }
        .item-card {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem;
            border-radius: 12px;
            background-color: var(--md-sys-color-surface-container);
            transition: all 0.2s ease-in-out;
            border: 1px solid var(--md-sys-color-outline-variant);
        }
        .item-card:hover {
            background-color: var(--md-sys-color-surface-container-high);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        .icon-button {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background-color: transparent;
            color: var(--md-sys-color-on-surface-variant);
            cursor: pointer;
            transition: all 0.2s;
        }
        .icon-button:hover {
            background-color: rgba(var(--md-sys-color-primary), 0.08);
        }
        .ripple-effect { position: relative; overflow: hidden; }
        .ripple { position: absolute; border-radius: 50%; background-color: rgba(255, 255, 255, 0.3); transform: scale(0); animation: ripple-animation 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94); pointer-events: none; }
        @keyframes ripple-animation { to { transform: scale(4); opacity: 0; } }

        /* Yeni eklenen CSS */
        .enlarged-image-container { 
            z-index: 1100; 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            background-color: rgba(0,0,0,0.85);
            backdrop-filter: blur(5px); /* Hafif bulanıklık efekti */
            -webkit-backdrop-filter: blur(5px);
        }
        .enlarged-image { 
            max-width: 90%; 
            max-height: 90%; 
            object-fit: contain;
            border-radius: 8px; /* Resmi köşeleri yuvarlama */
        }
    </style>
</head>
<body class="p-4 sm:p-6 md:p-8">

    <div id="app" class="max-w-screen-xl mx-auto">
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-extrabold" style="color: var(--md-sys-color-primary);">Yönetim Paneli</h1>
            <p class="text-lg mt-2" style="color: var(--md-sys-color-on-surface-variant);">Karakterleri, Füzyonları ve Gizli Sırları Yönet</p>
        </header>

        <div class="bg-[var(--md-sys-color-surface-container)] rounded-2xl p-6 mb-8">
            <h2 class="text-2xl font-bold mb-4">Yönetici Girişi</h2>
            <div id="login-form-container">
                <input type="email" id="admin-email" placeholder="E-posta" class="form-input mb-3">
                <input type="password" id="admin-password" placeholder="Şifre" class="form-input mb-3">
                <button id="login-btn" class="p-3 bg-green-600 rounded hover:bg-green-500 font-bold w-full">Giriş Yap</button>
                <p id="login-status" class="mt-3 text-center text-red-400"></p>
            </div>
            <p id="logged-in-status" class="mt-3 text-center text-green-400 hidden">Yönetici olarak giriş yapıldı. <button id="logout-btn" class="underline text-blue-300">Çıkış Yap</button></p>
        </div>
        <div class="mb-6 flex flex-col sm:flex-row gap-4 items-center">
            <input type="text" id="search-input" placeholder="Karakter ara..." class="form-input flex-grow">
            <button id="toggle-form-btn" class="p-3 bg-gray-700 rounded hover:bg-gray-600 font-bold w-full sm:w-auto">
                Yeni Kayıt Ekle ▼
            </button>
        </div>
        
        <div id="add-edit-form-container" class="bg-[var(--md-sys-color-surface-container)] rounded-2xl p-6 mb-8">
            <h2 id="form-title" class="text-2xl font-bold mb-4">Yeni Kayıt Ekle</h2>
            <form id="add-edit-form" class="flex flex-col gap-3">
                <select id="item-type-select" class="form-input mb-2">
                    <option value="character">Normal Karakter</option>
                    <option value="fusion">Füzyon</option>
                    <option value="easterEgg">Easter Egg</option>
                </select>
                
                <input required type="text" name="id" placeholder="Kayıt ID (benzersiz olmalı)" class="form-input">
                <input required type="text" name="name" placeholder="İsim" class="form-input">
                <input required type="text" name="imageUrl" placeholder="Ana Resim URL" class="form-input">

                <div id="character-fields" class="flex flex-col gap-3">
                    <input type="text" name="evolutions_1" placeholder="2★ Resim URL (isteğe bağlı)" class="form-input">
                    <input type="text" name="evolutions_2" placeholder="3★ Resim URL (isteğe bağlı)" class="form-input">
                </div>

                <div id="fusion-fields" class="hidden flex-col gap-3">
                    <input type="text" name="fusionPartners_0" placeholder="Partner 1 ID" class="form-input">
                    <input type="text" name="fusionPartners_1" placeholder="Partner 2 ID" class="form-input">
                </div>

                <div id="easter-egg-fields" class="hidden flex-col gap-3">
                    <input type="text" name="originalCharacterId" placeholder="Orijinal Karakter ID" class="form-input">
                </div>
                
                <div class="flex gap-2 mt-4">
                    <button type="submit" id="save-button" class="flex-grow p-3 bg-blue-600 rounded hover:bg-blue-500 font-bold">Kaydet</button>
                    <button type="button" id="cancel-button" class="hidden flex-grow p-3 bg-gray-600 rounded hover:bg-gray-500 font-bold">İptal</button>
                </div>
            </form>
        </div>

        <main>
            <h2 class="text-2xl font-bold mb-4">Mevcut Kayıtlar</h2>
            <div id="admin-grid" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                </div>
            <p id="no-results" class="text-center text-lg mt-8 hidden" style="color: var(--md-sys-color-on-surface-variant);">Hiçbir kayıt bulunamadı.</p>
        </main>
    </div>

    <div id="enlarged-image-overlay" class="enlarged-image-container hidden" onclick="closeEnlargedImage()">
        <button class="icon-button absolute top-4 right-4 text-white text-4xl z-10" onclick="closeEnlargedImage(event)" aria-label="Resmi Kapat">
            <span class="material-symbols-outlined" style="font-size: 36px;">close</span>
        </button>
        <img id="enlarged-image" src="" alt="Büyük Resim" class="enlarged-image">
    </div>

    <script>
        const firebaseConfig = {
  apiKey: "AIzaSyDrEU_QEuvf960ZPxo29n6x8N9K7yGIkCQ",
  authDomain: "karaktergalerisi-dc337.firebaseapp.com",
  projectId: "karaktergalerisi-dc337",
  storageBucket: "karaktergalerisi-dc337.firebasestorage.app",
  messagingSenderId: "486669559067",
  appId: "1:486669559067:web:20c76a78a41d9bc0bbdfbe"
};
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        let characters = [];
        let easterEggs = [];
        let editingItemId = null;
        let editingItemType = null;
        const dom = {
            addEditFormContainer: document.getElementById('add-edit-form-container'),
            toggleFormBtn: document.getElementById('toggle-form-btn'),
            addEditForm: document.getElementById('add-edit-form'),
            itemTypeSelect: document.getElementById('item-type-select'),
            characterFields: document.getElementById('character-fields'),
            fusionFields: document.getElementById('fusion-fields'),
            easterEggFields: document.getElementById('easter-egg-fields'),
            formTitle: document.getElementById('form-title'),
            saveButton: document.getElementById('save-button'),
            cancelButton: document.getElementById('cancel-button'),
            adminGrid: document.getElementById('admin-grid'),
            searchInput: document.getElementById('search-input'),
            noResults: document.getElementById('no-results'),
            enlargedImageOverlay: document.getElementById('enlarged-image-overlay'),
            enlargedImage: document.getElementById('enlarged-image'),

            // Yeni eklenen DOM elementleri (Giriş/Çıkış için)
            adminEmailInput: document.getElementById('admin-email'),
            adminPasswordInput: document.getElementById('admin-password'),
            loginBtn: document.getElementById('login-btn'),
            loginStatus: document.getElementById('login-status'),
            loggedInStatus: document.getElementById('logged-in-status'),
            logoutBtn: document.getElementById('logout-btn'),
        };

        // Mevcut kodunuzdaki gibi yardımcı fonksiyonlar
        const getStarEmojis = (isFusion, starCount, iconName = 'star') => {
            const colors = { 1: 'text-orange-400', 2: 'text-slate-400', 3: 'text-amber-400', 4: 'text-fuchsia-400' };
            const colorKey = isFusion ? 4 : Math.min(starCount, 3);
            const starIcon = `<span class="material-symbols-outlined ${colors[colorKey]}" style="font-variation-settings: 'FILL' 1;">${iconName}</span>`;
            const starHtml = Array(starCount).fill(starIcon).join('');
            return isFusion ? `<div class="flex">${starHtml}</div>` : `<div class="flex">${starHtml}</div>`;
        };

        const get3StarImageUrl = (baseCharId) => {
            const baseChar = characters.find(c => c.id === baseCharId && !c.isFusion);
            const threeStarEvo = baseChar?.evolutions.find(e => e.star === 3);
            return threeStarEvo ? threeStarEvo.imageUrl : (baseChar ? baseChar.imageUrl : '');
        };

        // Arama ve Galeri Yenileme Fonksiyonu
        function renderAdminPanel() {
            dom.adminGrid.innerHTML = '';
            const query = dom.searchInput.value.toLowerCase().trim();
            const allItems = [...characters, ...easterEggs].sort((a,b) => a.name.localeCompare(b.name, 'tr'));
            
            const filteredItems = allItems.filter(item => 
                item.name.toLowerCase().includes(query) || item.id.toLowerCase().includes(query)
            );

            if (filteredItems.length === 0) {
                dom.noResults.classList.remove('hidden');
            } else {
                dom.noResults.classList.add('hidden');
            }

            filteredItems.forEach(item => {
                const card = document.createElement('div');
                card.className = 'item-card';

                const isFusion = item.isFusion;
                const isEasterEgg = item.originalCharacterId;
                const starCount = isFusion ? 4 : (isEasterEgg ? 1 : (item.star || 1));
                const starIcon = isEasterEgg ? 'favorite' : 'star';
                const starHtml = getStarEmojis(isFusion || isEasterEgg, starCount, starIcon);
                
                const nameClass = isFusion || isEasterEgg ? 'font-fantastical-fusion' : '';

                card.innerHTML = `
                    <div class="w-16 h-16 flex-shrink-0 rounded-lg overflow-hidden cursor-zoom-in" onclick="enlargeImage('${item.imageUrl}')">
                        <img src="${item.imageUrl}" alt="${item.name}" class="w-full h-full object-cover">
                    </div>
                    <div class="flex-grow">
                        <h4 class="font-bold text-lg truncate ${nameClass}">${item.name}</h4>
                        <p class="text-sm text-gray-400">ID: ${item.id}</p>
                        <div class="flex mt-1">${starHtml}</div>
                    </div>
                    <div class="flex-shrink-0 flex gap-2">
                        <button class="icon-button edit-button" data-id="${item.id}" data-type="${isFusion ? 'fusion' : (isEasterEgg ? 'easterEgg' : 'character')}" aria-label="Düzenle">
                            <span class="material-symbols-outlined">edit</span>
                        </button>
                        <button class="icon-button delete-button" data-id="${item.id}" data-type="${isFusion ? 'fusion' : (isEasterEgg ? 'easterEgg' : 'character')}" aria-label="Sil">
                            <span class="material-symbols-outlined">delete</span>
                        </button>
                    </div>
                `;
                dom.adminGrid.appendChild(card);
            });
            setupEditDeleteListeners();
        }

        // Form alanlarının görünürlüğünü yönetir
        function toggleFormFields() {
            const selectedType = dom.itemTypeSelect.value;
            dom.characterFields.classList.add('hidden');
            dom.fusionFields.classList.add('hidden');
            dom.easterEggFields.classList.add('hidden');
            if (selectedType === 'character') { dom.characterFields.classList.remove('hidden'); }
            else if (selectedType === 'fusion') { dom.fusionFields.classList.remove('hidden'); }
            else if (selectedType === 'easterEgg') { dom.easterEggFields.classList.remove('hidden'); }
        }

        // Düzenleme ve silme butonlarına olay dinleyicisi ekler
        function setupEditDeleteListeners() {
            dom.adminGrid.querySelectorAll('.edit-button').forEach(button => {
                button.addEventListener('click', (e) => {
                    const id = e.currentTarget.dataset.id;
                    const type = e.currentTarget.dataset.type;
                    loadItemForEdit(id, type);
                });
            });
            dom.adminGrid.querySelectorAll('.delete-button').forEach(button => {
                button.addEventListener('click', (e) => {
                    const id = e.currentTarget.dataset.id;
                    const type = e.currentTarget.dataset.type;
                    deleteItem(id, type);
                });
            });
        }
        
        // Formu düzenleme için doldurur
        function loadItemForEdit(itemId, itemType) {
            let itemData;
            if (itemType === 'easterEgg') { itemData = easterEggs.find(i => i.id === itemId); }
            else { itemData = characters.find(i => i.id === itemId); }
            
            if (!itemData) {
                alert("Düzenlenecek kayıt bulunamadı.");
                return;
            }
            
            editingItemId = itemId;
            editingItemType = itemType;
            dom.formTitle.textContent = "Kaydı Düzenle";
            dom.itemTypeSelect.value = itemType;
            dom.itemTypeSelect.disabled = true;
            dom.addEditForm.elements['id'].value = itemId;
            dom.addEditForm.elements['id'].readOnly = true; 
            dom.addEditForm.elements['name'].value = itemData.name || '';
            dom.addEditForm.elements['imageUrl'].value = itemData.imageUrl || '';
            dom.saveButton.textContent = "Güncelle";
            dom.cancelButton.classList.remove('hidden');
            
            toggleFormFields();
            dom.addEditFormContainer.classList.remove('hidden'); // Formu görünür yap
            dom.toggleFormBtn.textContent = 'Yeni Kayıt Ekle ▲'; // Buton metnini güncelle

            if (itemType === 'character') {
                dom.addEditForm.elements['evolutions_1'].value = itemData.evolutions?.find(e=>e.star===2)?.imageUrl || '';
                dom.addEditForm.elements['evolutions_2'].value = itemData.evolutions?.find(e=>e.star===3)?.imageUrl || '';
            } else if (itemType === 'fusion') {
                dom.addEditForm.elements['fusionPartners_0'].value = itemData.fusionPartners?.[0] || '';
                dom.addEditForm.elements['fusionPartners_1'].value = itemData.fusionPartners?.[1] || '';
            } else if (itemType === 'easterEgg') {
                dom.addEditForm.elements['originalCharacterId'].value = itemData.originalCharacterId || '';
            }
        }

        // Formu sıfırlar
        function resetForm() {
            dom.addEditForm.reset();
            editingItemId = null;
            editingItemType = null;
            dom.formTitle.textContent = "Yeni Kayıt Ekle";
            dom.itemTypeSelect.disabled = false;
            dom.addEditForm.elements['id'].readOnly = false;
            dom.saveButton.textContent = "Kaydet";
            dom.cancelButton.classList.add('hidden');
            toggleFormFields();
            // Formu otomatik gizlemeyebiliriz, kullanıcı tekrar açabilir
            // dom.addEditFormContainer.classList.add('hidden'); 
            // dom.toggleFormBtn.textContent = 'Yeni Kayıt Ekle ▼';
        }

        // Kaydetme/Güncelleme işlemi
        async function handleFormSubmit(event) {
            event.preventDefault();
            const form = dom.addEditForm;
            const id = form.elements['id'].value.trim();
            if (!id) {
                alert("ID alanı boş bırakılamaz.");
                return;
            }

            const type = dom.itemTypeSelect.value;
            const isEditing = !!editingItemId;
            
            let data = {
                name: form.elements['name'].value.trim(),
                imageUrl: form.elements['imageUrl'].value.trim(),
            };
            let collectionName = 'characters';

            if (type === 'character') {
                data.star = 1;
                data.isFusion = false;
                data.evolutions = [];
                if (form.elements['evolutions_1'].value.trim()) data.evolutions.push({ star: 2, imageUrl: form.elements['evolutions_1'].value.trim() });
                if (form.elements['evolutions_2'].value.trim()) data.evolutions.push({ star: 3, imageUrl: form.elements['evolutions_2'].value.trim() });
            } else if (type === 'fusion') {
                data.star = 4;
                data.isFusion = true;
                data.fusionPartners = [];
                if (form.elements['fusionPartners_0'].value.trim()) data.fusionPartners.push(form.elements['fusionPartners_0'].value.trim());
                if (form.elements['fusionPartners_1'].value.trim()) data.fusionPartners.push(form.elements['fusionPartners_1'].value.trim());
            } else if (type === 'easterEgg') {
                collectionName = 'easterEggs';
                data.originalCharacterId = form.elements['originalCharacterId'].value.trim();
            }

            try {
                // Sadece giriş yapmış kullanıcılar yazma işlemi yapabilir
                if (firebase.auth().currentUser) { 
                    await db.collection(collectionName).doc(id).set(data, { merge: true });
                    alert(`Kayıt başarıyla ${isEditing ? 'güncellendi' : 'kaydedildi'}!`);
                    await fetchItems();
                    resetForm();
                } else {
                    alert("Bu işlemi yapmak için yönetici olarak giriş yapmalısınız.");
                }
            } catch (error) {
                console.error("Kayıt sırasında hata:", error);
                alert("Bir hata oluştu. Lütfen konsolu (F12) kontrol edin.");
            }
        }

        // Silme işlemi
        async function deleteItem(itemId, itemType) {
            const collectionName = itemType === 'easterEgg' ? 'easterEggs' : 'characters';
            const item = (itemType === 'easterEgg' ? easterEggs : characters).find(i => i.id === itemId);
            
            if (!item) {
                alert("Silinecek öğe bulunamadı.");
                return;
            }

            if (confirm(`'${item.name}' adlı kaydı kalıcı olarak silmek istediğinizden emin misiniz? Bu işlem geri alınamaz.`)) {
                try {
                    // Sadece giriş yapmış kullanıcılar silme işlemi yapabilir
                    if (firebase.auth().currentUser) {
                        await db.collection(collectionName).doc(itemId).delete();
                        alert("Kayıt başarıyla silindi.");
                        await fetchItems();
                    } else {
                        alert("Bu işlemi yapmak için yönetici olarak giriş yapmalısınız.");
                    }
                } catch (error) {
                    console.error("Silme işlemi sırasında hata:", error);
                    alert("Bir hata oluştu. Lütfen konsolu (F12) kontrol edin.");
                }
            }
        }

        // Verileri Firebase'den çeker ve galeriyi yeniler
        async function fetchItems() {
            try {
                const charactersSnapshot = await db.collection('characters').get();
                characters = charactersSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                const easterEggsSnapshot = await db.collection('easterEggs').get();
                easterEggs = easterEggsSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                console.log("Firebase'den veriler başarıyla çekildi!");
                renderAdminPanel();
            } catch (error) {
                console.error("Veriler çekilirken hata oluştu:", error);
                dom.adminGrid.innerHTML = `<p class="col-span-full text-center text-lg text-red-500">Veriler çekilemedi. Lütfen Firebase ayarlarınızı kontrol edin.</p>`;
            }
        }

        // Resim büyütme fonksiyonu
        function enlargeImage(src) {
            dom.enlargedImage.src = src;
            dom.enlargedImageOverlay.classList.remove('hidden');
        }

        // Büyütülmüş resmi kapatma fonksiyonu
        function closeEnlargedImage(event) {
            if (event) event.stopPropagation(); // Event yayılımını durdur
            dom.enlargedImageOverlay.classList.add('hidden');
        }

        // Yönetici arayüz elementlerinin etkinliğini günceller
        function updateAuthUI(user) {
            const loginFormContainer = document.getElementById('login-form-container'); 
            if (user) {
                // Kullanıcı giriş yaptıysa
                loginFormContainer.classList.add('hidden'); // Giriş formunu gizle
                dom.loggedInStatus.classList.remove('hidden'); // "Giriş yapıldı" mesajını göster

                // Ekleme/düzenleme formunu ve butonlarını etkinleştir
                dom.addEditFormContainer.style.pointerEvents = 'auto'; // Form alanlarını etkileşime aç
                dom.addEditForm.style.opacity = '1'; // Normal görünümüne getir
                dom.toggleFormBtn.disabled = false; // Formu gösterme/gizleme butonunu etkinleştir
                // Tüm düzenleme ve silme butonlarını etkinleştir
                dom.adminGrid.querySelectorAll('.edit-button, .delete-button').forEach(btn => btn.disabled = false);

            } else {
                // Kullanıcı çıkış yaptıysa veya giriş yapmadıysa
                loginFormContainer.classList.remove('hidden'); // Giriş formunu göster
                dom.loggedInStatus.classList.add('hidden'); // "Giriş yapıldı" mesajını gizle
                dom.loginStatus.textContent = ''; // Mesajı temizle
                dom.adminEmailInput.value = ''; // E-posta alanını temizle
                dom.adminPasswordInput.value = ''; // Şifre alanını temizle

                // Ekleme/düzenleme formunu ve butonlarını devre dışı bırak
                dom.addEditFormContainer.style.pointerEvents = 'none'; // Form alanlarını etkileşime kapat
                dom.addEditForm.style.opacity = '0.5'; // Gri tonlu yap
                dom.toggleFormBtn.disabled = true; // Form gösterme/gizleme butonunu devre dışı bırak
                // Tüm düzenleme ve silme butonlarını devre dışı bırak
                dom.adminGrid.querySelectorAll('.edit-button, .delete-button').forEach(btn => btn.disabled = true);
            }
        }

        // Uygulama başlatma
        document.addEventListener('DOMContentLoaded', () => {
            fetchItems(); // Sayfa yüklendiğinde verileri çek

            dom.itemTypeSelect.addEventListener('change', toggleFormFields);
            dom.addEditForm.addEventListener('submit', handleFormSubmit);
            dom.cancelButton.addEventListener('click', resetForm);
            dom.searchInput.addEventListener('input', renderAdminPanel);

            // Form gizle/göster butonu dinleyicisi
            dom.toggleFormBtn.addEventListener('click', () => {
                dom.addEditFormContainer.classList.toggle('hidden');
                if (dom.addEditFormContainer.classList.contains('hidden')) {
                    dom.toggleFormBtn.textContent = 'Yeni Kayıt Ekle ▼';
                } else {
                    dom.toggleFormBtn.textContent = 'Yeni Kayıt Ekle ▲';
                }
            });

            // Başlangıçta formu gizle
            dom.addEditFormContainer.classList.add('hidden');
            dom.toggleFormBtn.textContent = 'Yeni Kayıt Ekle ▼';

            // Kimlik Doğrulama İşlevselliği
            dom.loginBtn.addEventListener('click', async () => {
                const email = dom.adminEmailInput.value;
                const password = dom.adminPasswordInput.value;
                dom.loginStatus.textContent = ''; // Hata mesajını temizle

                try {
                    await firebase.auth().signInWithEmailAndPassword(email, password);
                    dom.loginStatus.textContent = 'Giriş başarılı!';
                    dom.loginStatus.style.color = 'lightgreen';
                    updateAuthUI(firebase.auth().currentUser); // UI'ı güncelle
                } catch (error) {
                    dom.loginStatus.textContent = `Giriş Hatası: ${error.message}`;
                    dom.loginStatus.style.color = 'red';
                    console.error("Giriş hatası:", error);
                }
            });

            dom.logoutBtn.addEventListener('click', async () => {
                try {
                    await firebase.auth().signOut();
                    dom.loginStatus.textContent = 'Çıkış yapıldı.';
                    dom.loginStatus.style.color = 'lightgreen';
                    updateAuthUI(null); // UI'ı güncelle
                } catch (error) {
                    dom.loginStatus.textContent = `Çıkış Hatası: ${error.message}`;
                    dom.loginStatus.style.color = 'red';
                    console.error("Çıkış hatası:", error);
                }
            });

            // Kullanıcı oturum durumunu izle
            // Sayfa yüklendiğinde veya kullanıcı giriş/çıkış yaptığında otomatik çalışır.
            firebase.auth().onAuthStateChanged((user) => {
                updateAuthUI(user);
            });
        });
    </script>
</body>
</html>
